<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width" />

    <title>笑话机</title>

    <link href="style.css" rel="stylesheet" />
  </head>

  <body>
    <a href="../javascript-start.html">back to main</a>
    <hr />
    <div>
      <label for="customname">输入自定义名字：</label>
      <input id="customname" type="text" placeholder="李雷" />
    </div>
    <div>
      <label for="metric">公制</label
      ><input id="metric" type="radio" name="measure" value="metric" checked />
      <label for="american">美制</label
      ><input id="american" type="radio" name="measure" value="american" />
    </div>
    <div>
      <button class="randomize">生成随机笑话</button>
    </div>
    <!-- 鸣谢：Willy Aguirre 提供的测试代码 -->
    <p class="story"></p>
  </body>

  <script>
    const customName = document.getElementById("customname");
    const randomize = document.querySelector(".randomize");
    const story = document.querySelector(".story");

    function randomValueFromArray(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    let storyText =
      "今天气温 34 摄氏度，:inserta:出去遛弯。当走到:insertb:门前时，突然就:insertc:。人们都惊呆了，李雷全程目睹但并没有慌，因为:inserta:是一个 140 公斤的胖子，天气又辣么热。";
    let insertX = "怪兽威利, 大老爹, 圣诞老人";
    let insertY = "肯德基, 迪士尼乐园, 白宫";
    let insertZ = "自燃了, 在人行道化成了一坨泥, 变成一条鼻涕虫爬走了";

    randomize.addEventListener("click", result);

    function result() {
      // 如果用户输入了名字, 则使用用户输入的名字
      if (customName.value !== "") {
        let name = customName.value;
        storyText = storyText.replaceAll("李雷", name);
      }

      if (document.getElementById("american").checked) {
        let weight = Math.round(300);
        let temperature = Math.round(94);
        storyText = storyText.replace("34 摄氏度", `${temperature} 华氏度`);
        storyText = storyText.replace("140 公斤", `${weight} 磅`);
      }

      let newStory = storyText;
      let xItem = randomValueFromArray(insertX.split(","));
      let yItem = randomValueFromArray(insertY.split(","));
      let zItem = randomValueFromArray(insertZ.split(","));

      console.log(xItem, yItem, zItem);

      newStory = newStory.replaceAll(":inserta:", xItem);
      newStory = newStory.replace(":insertb:", yItem);
      newStory = newStory.replace(":insertc:", zItem);

      story.textContent = newStory;
      story.style.visibility = "visible";
    }
  </script>
</html>
